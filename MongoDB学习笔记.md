# MongoDB学习笔记

# 安装MongoDB
#### windows安装(仅限64位系统)
下载软件：https://fastdl.mongodb.org/win32/mongodb-win32-x86_64-2012plus-4.2.6-signed.msi  
安装软件：下一步 下一步，在倒数第2步界面左下角有一个选项“Install MongoDB Compass”，可以取消勾选，稍后单独安装 MongoDB Compass  
运行软件：安装完成后，找到 安装目录\MongoDB\Server\4.2\bin\mongo.exe，运行mongo.exe  
编写测试：  
````
var message = 'hello mongodb'
pritejson(message)
````

#### 安装MongoDB Compass：  
MongoDB Compass 是图形可视化管理MongoDB数据库的工具。  
若在安装 MongoDB 过程中，没有同步安装 MongoDB Compass，需要手工下载并安装。  
下载软件：https://downloads.mongodb.com/compass/mongodb-compass-1.21.2-win32-x64.msi  
安装软件：下一步 下一步  
运行软件：运行MongoDBCompass.exe，进入软件后，先看完软件介绍后，点击继续按钮，即可看到当前本机MongoDB数据状态。  

# MongoDB优势
MongoDB以JSON文档形式储存数据。  

以下笔记来源于：唐建法的《MongoDB高手课》视频教程  

对于JSON而言：  
1、简单直观：以自然的方式来建模(自由定义数据模型)，以直观的方式与数据库交互(JSON与Object可直接相互转换)。  
2、结构灵活：弹性模式从容相应需求的频繁变化(不要求某集合中所有元素属性都必须一致)。  
3、快速开发：做更少的事，写更少的代码(可直接把数据以Object形式传递给数据库，而不像Mysql那样需要把一条数据中的各个属性拆分出来)。  

不需要考虑错综复杂的关系模型、一目了然的对象模型。  

对于开发人员而言：  
1、灵活：快速响应业务变化，具体表现为：  

- 多形性：同一个集合中可以包含不同字段(类型)的文档对象。即JSON的特性，例如允许某集合中前100名用户有一个属性，而100名以后的用户没有该属性。
- 动态性：线上修改数据模式，修改时应用和数据库均无需下线。 例如某集合所有数据由原来的每条10个属性增加到12个属性，这个操作可以直接在线上操作，无需让数据库先关停修改好后再上线。
- 数据治理：支持使用JSON Schema 来规范数据模式。在保证模式灵活动态的前提下，提供数据治理能力。  简单来说就是MongoDB也可以像Mysql那样对每个表(在MongoDB中叫集合)进行数据格式规范。 

2、快速：JSON模型的快速特性(数据库运行效率、程序员开发效率)
  
- 数据库引擎只需要在一个存储区读写：相对Mysql需要建立多个关联表而言，MongoDB某一集合所有数据均在同一个存储区里。  
- 反范式、无关联的组织极大优化查询速度：对于计算机而言，修改一条数据需要“定位和读写”，而“定位”和“读写”所需要消耗的性能占比，分别为95%和5%。 也就是说对于修改某条数据而言“定位”是最花费时间的。而Mysql通常为多表，不同表之间相互切换定位所花费时间会更多。最为关键的是开发者编写的代码，如果是Mysql需要编写多个表的操作代码，如果是MongoDB则直接操作一个集合即可。  
- 程序API自然，开发快速：JSON非常接近程序员原本的对象操作方式，所以开发效率高。

对于运维人员而言：  
1、原生的高可用和横向扩展能力：  

- 节点 复制集(Replica Set)数量可以是2-50个，默认安装为3个(1个Primary和2个Secondary)
- 自动恢复，若主节点发生故障，从节点可自动恢复替换主节点。
- 支持多中心部署，多中心容灾，数据同步。
- 滚动服务。 例如先只修改其中一个副节点，然后通过 MongoDB复制集 的方式将其他节点都进行修改，从而实现数据库不下线的情况下进行数据库改造升级。  

2、横向扩展能力：  

- 通过分片集群，可以无缝扩展
- 应用全透明
- 多种数据分布策略
- 轻松支持TB-PB数量级

MongoDB技术优势总结：  
1、JSON结构和对象模型接近、开发代码量低  
2、JSON的动态模型意味着更容易响应新的业务变化需求  
3、复制集提供高可用  
4、分片架构支持海量数据和无缝扩容  

## MongoDB基础用法

#### 创建数据库
命令代码：use xxx  
详细说明：  
1、创建数据库语法关键词：use  
2、xxx 即要创建的数据库名字  
3、若数据库不存在，MongoDB则会创建名为xxx的数据库  
4、若数据库已存在，MongoDB也不会报错  
4、无论新创建或是本身已存在，执行use xxx 后都会自动切换到该数据库  

例如，创建数据库moodmap：use moodmap  
若没有moodmap数据库则创建，若有则忽略，无论怎样都会切换到该数据库，命令面板会提示：switched to db moodmap  

注意：本文后面的代码示例中，均以 db.moodmap 这个数据库为例。  

#### 添加数据
命令代码：xxx.insert(json)  
详细说明：  
1、添加数据语法关键词：inset  
2、json即要添加的数据，格式为JSON  
3、若要添加多条数据，则可使用数据，例如：[json1,json2]  
4、添加完成后，会返回该数据，其中MongoDB会自动为该条数据添加 _id 的属性值。  
5、若不想使用MongoDB默认的_id值，需要提前在json数据中心设定 _id属性。  

特别强调：  
1、若我们向db.xxx添加数据时，db.xxx根本不存在(未使用use xxx创建该数据库)，MongoDB会自动为我们创建 xxx 这个数据库。  


#### 查找数据
命令代码：xxx.find({})  
详细说明：  
1、查找数据语法关键词：find  
2、{}为查找条件  

- {} 空对象，则表示条件不限，查找全部
- {name:'puxiao'} 包含某属性值得JSON对象，则表示查找name为‘puxiao’的数据
- {age:{$gt:30}} 属性值为{$xx:value}，则表示查找age满足特定条件的数据

3、$xx 比较关键词 对应含义  

- $gt 大于
- $gte 大于等于
- $lt 小于
- $lte 小于等于
- $eq 等于
- $ne 不等于
- $in 包含
- $nin 不包含


#### 遍历游标
命令代码：xxx.hasNext()、xxx.next()  
详细说明：  
1、声明 xxx 为某个查询结果  
2、可通过 while(xxx.hasNext()){xxx.next()} 来循环遍历查询结果
3、hasNext()即表示‘是否还有下一个’  
4、next()即表示‘将游标切换到下一个’


#### 查询修饰符
命令代码：limit(num)、sort({name:-1|1})  
详细说明：
limit(num) 用来限定返回结果数量，例如limit(10)表示最多返回10条结果即可。  
举例：db.xx.find({}).limit(10)  

sort({xxx:-1}) 用来设定按降序排序，如果是sort({xxx:1})则表示按升序排序。  
举例：db.xx.find({}).sort({age:-1}) 按属性age的降序排序  


#### 查询结果统计
命令代码：xxx.count()  
详细说明：使用count()函数可对结果数量进行统计  
举例：db.xxx.find({}).count() 返回查询返回结果的数量  


#### 删除数据
命令代码：xxx.remove(json)  
详细说明：  
1、删除数据语法关键词：remove  
2、json为我们要删除对象的条件
3、删除对象的条件和查找数据的条件，语法一模一样  

- {} 删除所有数据  
- {age:28} 删除所有属性age值为28的数据  
- {age:{$lt:18}) 删除所有属性age值小于18的数据  

注意：删除默认是‘批量多条’的操作行为。  


#### 更新数据
命令代码：xxx.update(json,{$set:json2},{xx})  
详细说明：  
1、update()函数有2个必填参数和1个可选参数  
2、第1、第2个参数为必填，第3个参数为可选参数  
3、第1个参数为查询条件  
4、第2个参数为需要修改的属性与值，格式需要遵循 {$set:{'xx':value}} 的格式  
5、第3个参数为可选参数，为更新选项设置  

举例：db.xxx.update({age:18},{$set:{'age':34}}) 将属性age值为18的数据修改为age值为34  

第3个更新选项配置，一共有3个属性，分别是：

- upsert 当原本不存在要修改的属性时是否添加该属性，默认为false，即不添加
- multi 是否为更新多条数据，默认为false，即只更新1条
- writeConcern 抛出异常的等级

举例：db.xxx.update({age:18},{$set:{'age':34}},{multi:true}) 查找属性age值为18的数据，并将他们的属性age值全部修改为34  

